# Redux

-   Third Party library that can be used in any JavaScript project, not just React:
    -   State management system
        -   Local state: Affects a single component
        -   Cross-Component State: It’s share between a few components and can be managed with prop drilling, like modals
        -   App-Wide State: Is shared across the app and it’s better to manage it using a context, like authentication, here’s where Redux comes handy
-   Redux toolkit simplifies its use
-   Difference with React Context API:
    -   React context is better for small or medium applications
        -   It’s not good for applications with a lot of data changes
        -   It can lead to a deeply nested JSX code or huge context providers
    -   Redux has better performance on larger Apps
-   How does Redux works?

    -   It has one Central Data (State) Store
    -   The data store can be accessed across the whole App
    -   Reducers[^1] modify the data on the store through dispatch actions
    -   When the reducer is triggered it modifies the state and the value is updated in the UI

-   Simple example outside of React:

    ```JS
    const redux = require('redux');

    /*
    * The reducer function is responsible for updating the state based on the action.
    * It holds the state of the application and returns a new state based on the action.
    * It should be a pure function: Returns an output with equal structure than the input.
    * It can't hold side effects inside, like fetching an API.
    *
    * - Note that state needs a default value.
    *
    * @param {Object}, {Object}
    *
    */
    const counterReducer = (state = { counter: 0 }, action) => {
        switch (action.type) {
            case 'INCREMENT':
                return { counter: state.counter + 1 };
            case 'DECREMENT':
                return { counter: state.counter - 1 };
            case 'ADD':
                return { counter: state.counter + action.value };
            case 'SUBSTRACT':
                return { counter: state.counter - action.value };
            default:
                return state;
        }
    };

    /*
    * Now that we have a reducer, we need to create a store
    * and pass our counterReducer to it as an argument,
    * this way the store will know how to update its state.
    *
    */
    const store = redux.createStore(counterReducer);

    /*
    * Now that we have a store, we can create a subscriber function
    * that will be called every time the state changes.
    *
    * @param {Function}
    */
    const contentSubscriber = () => {
        // First we get the latest state snapshot from the store.
        const latestState = store.getState();
        console.log(latestState);
    }

    // Now that we have a store and a subscriber, we can start listening to the store.
    store.subscribe(contentSubscriber);

    // Now that we have a store, we can dispatch an action.
    store.dispatch({ type: 'INCREMENT' }); // { counter: 1 }
    store.dispatch({ type: 'DECREMENT' }); // { counter: 0 }
    store.dispatch({ type: 'ADD', value: 10 }); // { counter: 10 }
    store.dispatch({ type: 'SUBSTRACT', value: 5 }); // { counter: 5 }
    ```

## Redux in React

-   To be able to use Redux in React you'll need to install both `redux` and `react-redux`
    ```SHELL
    npm install redux react-redux
    ```
-   Then on your react project you can create a `store` folder and add your redux file

    ```JS
    // src/store/index.js
    import { createStore } from 'redux';

    const reducer = (state = { counter: 0 }, action) => {
        switch (action.type) {
            case 'INCREASE':
                return { counter: state.counter + 1 }
            case 'DECREASE':
                return { counter: state.counter - 1 }
            default:
                return state;
        }
    }

    const store = createStore(reducer);

    // It will be consumed outside the store file
    export default store;
    ```

-   Ans provide it to the whole app (just the children of the component that has the provider will have access to the context)

    ```JS
    // src/index.js
    import React from 'react';
    import ReactDOM from 'react-dom/client';
    import { Provider } from 'react-redux';
    import './index.css';
    import App from './App';
    import store from './store';

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Provider store={store}> <App /></ Provider>);
    ```

-   With `react-redux` we can import parts of our store to different components using `useSelector`
-   If we need to dispatch the state we can use `useDispatch`

    ```JS
    // Functional component
    import { useSelector, useDispatch } from 'react-redux';
    import classes from './Counter.module.css';

    const Counter = () => {
        /*
        * useSelector is a hook that allows you to access the state of the store.
        * Behind the scenes it executes the function passed to it and returns the value of the state.
        * It's automagically subscribed to the store, and updates the values reactively.
        * When the element is unmounted, the subscription is automatically unsubscribed.
        */
        const counter = useSelector(state => state.counter),
            dispatch = useDispatch(), // We need to call the hook to use it
            incrementHandler = () => dispatch({ type: 'INCREASE' }),
            decrementHandler = () => dispatch({ type: 'DECREASE' }),
            toggleCounterHandler = () => { };

        return (
            <main className={classes.counter}>
              <h1>Redux Counter</h1>
              <div className={classes.value}>{counter}</div>
              <div className={classes.actions}>
                  <button onClick={incrementHandler}>Increment</button>
                  <button onClick={decrementHandler}>Decrement</button>
              </div>
            </main>
        );
    };

    export default Counter;
    ```

-   For class based components follow this pattern

    ```JS
    // Class based
    import React from 'react';
    import { useSelector, useDispatch } from 'react-redux';
    import classes from './Counter.module.css';

    class Counter extends React.Component {
      incrementHandler() { this.props.increment() }
      decrementHandler() { this.props.decrement() }

      render() {
        return (
          <main className={classes.counter}>
            <h1>Redux Counter</h1>
            <div className={classes.value}>{this.props.counter}</div>
            <div className={classes.actions}>
              <button onClick={this.incrementHandler.bind(this)}>Increment</button>
              <button onClick={this.decrementHandler.bind(this)}>Decrement</button>
            </div>
          </main>
        );
      }
    }

    const mapStateToProps = state => {
      return { counter: state.counter };
    };

    const mapDispatchToProps = dispatch => {
        return {
            increment: () => dispatch({ type: 'INCREASE' }),
            decrement: () => dispatch({ type: 'DECREASE' }),
        }
    }

    export default connect(mapStateToProps, mapDispatchToProps)(Counter);
    ```

[^1]: Reducer is a general concept in development, it refers to a function that takes a value and modify it.
